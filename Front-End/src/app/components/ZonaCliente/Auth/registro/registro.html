<h3 class="fw-bold">CREAR CUENTA</h3>
<p class="text-muted">Complete los siguientes datos para crear su cuenta con el correo electrónico <strong>{{email()}}</strong></p>

<form [formGroup]="registroForm" class="mt-4" (ngSubmit)="registrar()">
  <!-- Username -->
  <div class="mb-3">
    <label for="username" class="form-label">Nombre de usuario <span class="text-danger">*</span></label>
    <input
      type="text"
      class="form-control"
      id="username"
      formControlName="username"
      required
      [class.is-invalid]="registroForm.get('username')?.invalid && registroForm.get('username')?.touched"
    >
    @if (registroForm.get('username')?.invalid && registroForm.get('username')?.touched) {
      <div class="invalid-feedback">
        @if (registroForm.get('username')?.errors?.['required']) {
          El nombre de usuario es requerido
        }
        @if (registroForm.get('username')?.errors?.['minlength']) {
          El nombre de usuario debe tener al menos 3 caracteres
        }
      </div>
    }
  </div>

  <!-- Password -->
  <div class="mb-3">
    <label for="password" class="form-label">Contraseña <span class="text-danger">*</span></label>
    <div class="input-group">
      <input
        [type]="mostrarPassword() ? 'text' : 'password'"
        class="form-control"
        id="password"
        formControlName="password"
        placeholder="••••••••"
        required
        [class.is-invalid]="registroForm.get('password')?.invalid && registroForm.get('password')?.touched"
      >
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="togglePasswordVisibility()"
        aria-label="Mostrar/Ocultar contraseña"
      >
        <span [innerHTML]="mostrarPassword() ? '&#128065;' : '&#128586;'"></span>
      </button>
    </div>
    @if (registroForm.get('password')?.invalid && registroForm.get('password')?.touched) {
      <div class="invalid-feedback d-block">
        @if (registroForm.get('password')?.errors?.['required']) {
          La contraseña es requerida
        }
        @if (registroForm.get('password')?.errors?.['minlength']) {
          La contraseña debe tener al menos 6 caracteres
        }
      </div>
    }
  </div>

  <!-- Nombre y Apellidos -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
      <input
        type="text"
        class="form-control"
        id="nombre"
        formControlName="nombre"
        required
        [class.is-invalid]="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched"
      >
      @if (registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched) {
        <div class="invalid-feedback">
          @if (registroForm.get('nombre')?.errors?.['required']) {
            El nombre es requerido
          }
        </div>
      }
    </div>
    <div class="col-md-6">
      <label for="apellidos" class="form-label">Apellidos <span class="text-danger">*</span></label>
      <input
        type="text"
        class="form-control"
        id="apellidos"
        formControlName="apellidos"
        required
        [class.is-invalid]="registroForm.get('apellidos')?.invalid && registroForm.get('apellidos')?.touched"
      >
      @if (registroForm.get('apellidos')?.invalid && registroForm.get('apellidos')?.touched) {
        <div class="invalid-feedback">
          @if (registroForm.get('apellidos')?.errors?.['required']) {
            Los apellidos son requeridos
          }
        </div>
      }
    </div>
  </div>

  <!-- Género -->
  <div class="mb-3">
    <label for="genero" class="form-label">Género <span class="text-danger">*</span></label>
    <select
      class="form-select"
      id="genero"
      formControlName="genero"
      required
      [class.is-invalid]="registroForm.get('genero')?.invalid && registroForm.get('genero')?.touched"
    >
      <option value="" disabled selected>Seleccione una opción</option>
      <option value="masculino">Masculino</option>
      <option value="femenino">Femenino</option>
      <option value="otro">Otro</option>
    </select>
    @if (registroForm.get('genero')?.invalid && registroForm.get('genero')?.touched) {
      <div class="invalid-feedback">
        @if (registroForm.get('genero')?.errors?.['required']) {
          El género es requerido
        }
      </div>
    }
  </div>

  <!-- DNI y Teléfono (Opcionales) -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="dni" class="form-label">DNI </label>
      <input
        type="text"
        class="form-control"
        id="dni"
        formControlName="dni"
        [class.is-invalid]="registroForm.get('dni')?.invalid && registroForm.get('dni')?.touched"
      >
      @if (registroForm.get('dni')?.invalid && registroForm.get('dni')?.touched) {
        <div class="invalid-feedback">
          @if (registroForm.get('dni')?.errors?.['pattern']) {
            El DNI debe tener 8 números seguidos de una letra
          }
        </div>
      }
    </div>
    <div class="col-md-6">
      <label for="telefono" class="form-label">Teléfono de contacto</label>
      <input
        type="tel"
        class="form-control"
        id="telefono"
        formControlName="telefono"
        [class.is-invalid]="registroForm.get('telefono')?.invalid && registroForm.get('telefono')?.touched"
      >
      @if (registroForm.get('telefono')?.invalid && registroForm.get('telefono')?.touched) {
        <div class="invalid-feedback">
          @if (registroForm.get('telefono')?.errors?.['pattern']) {
            El teléfono debe tener 9 dígitos
          }
        </div>
      }
    </div>
  </div>
  <br>
  <button type="submit" class="btn btn-secondary w-100 py-2 mb-3" [disabled]="registroForm.invalid">
    Crear Cuenta
  </button>

  <!-- Separador entre botones -->
  <div role="separator" aria-orientation="horizontal" class="separator"></div>

  <button type="button" class="btn-back w-100 py-2 mb-3" (click)="goBack()" aria-label="Volver">
    Volver
  </button>
</form>

<p class="small text-muted text-center">
  Al crear una cuenta, aceptas las <a href="#" class="text-decoration-none">Condiciones de uso</a> y la <a href="#" class="text-decoration-none">Política de Privacidad</a>.
</p>
